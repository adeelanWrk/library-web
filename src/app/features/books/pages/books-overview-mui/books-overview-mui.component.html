<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold text-center mb-8 text-blue-700">
    รายการหนังสือ
  </h1>

  <div *ngIf="isLoading" class="flex justify-center my-8">
    <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
  </div>

  <ng-container *ngIf="!isLoading && dataSource.data.length > 0">
    <div class="flex items-center justify-end gap-2 mb-4">
      <button (click)="showModel()"
        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded flex items-center">
        <i class="bi bi-download mr-2"></i> text to table
      </button>

      <button (click)="exportRawData()"
        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded flex items-center">
        <i class="bi bi-download mr-2"></i> Export Raw Data
      </button>

      <label for="fileUpload"
        class="cursor-pointer bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded flex items-center">
        <i class="bi bi-upload mr-2"></i> เลือกไฟล์และ Import
      </label>
      <input type="file" id="fileUpload" (change)="onFileChange($event)" accept=".xlsx,.xls" class="hidden" />
    </div>




    <div class="ag-alpine-container">
      <table mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef> Title </th>
          <td mat-cell *matCellDef="let element; let i = index" [attr.rowspan]="getRowSpan('title', i)"
            [style.display]="getRowSpan('title', i) ? '' : 'none'">
            {{ element?.title }}
          </td>
        </ng-container>

        <ng-container matColumnDef="publisher">
          <th mat-header-cell *matHeaderCellDef> Publisher </th>
          <td mat-cell *matCellDef="let element; let i = index" [attr.rowspan]="getRowSpan('publisher', i)"
            [style.display]="getRowSpan('publisher', i) ? '' : 'none'">
            {{ element.publisher }}
          </td>
        </ng-container>

        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef> Price </th>
          <td class="text-right" mat-cell *matCellDef="let element; let i = index"
            [attr.rowspan]="getRowSpan('price', i)" [style.display]="getRowSpan('price', i) ? '' : 'none'">
            {{ element.price | number }}
          </td>
        </ng-container>

        <ng-container matColumnDef="authorCount">
          <th mat-header-cell *matHeaderCellDef> Author Count </th>
          <td class="text-right" mat-cell *matCellDef="let element; let i = index"
            [attr.rowspan]="getRowSpan('authorCount', i)" [style.display]="getRowSpan('authorCount', i) ? '' : 'none'">
            {{ element.authorCount }}
          </td>
        </ng-container>

        <ng-container matColumnDef="authorName">
          <th mat-header-cell *matHeaderCellDef> Author </th>
          <td mat-cell *matCellDef="let element"> {{ element.authorName }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="headerColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator [length]="paginationProperties.totalItems" [pageSize]="paginationProperties.pageSize"
        [pageSizeOptions]="paginationProperties.pageSizeOptions" (page)="onPageChange($event)">
      </mat-paginator>
    </div>
  </ng-container>

  <div *ngIf="!isLoading && dataSource.data.length === 0" class="text-center text-gray-500 my-8">
    ไม่มีข้อมูลที่จะแสดง
  </div>
</div>